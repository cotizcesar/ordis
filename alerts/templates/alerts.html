{% extends 'base.html' %}
{% load humanize %}
{% load custom_filters %}
{% block head_title %}Alerts{% endblock %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-3">
            {% if user.is_authenticated %}
            <div class="my-3">
                {% include 'user/user_thumb.html' %}
            </div>
            {% endif %}
            <div class="my-3">
                <p class="text-uppercase bg-title px-3 py-2 m-0"><i class="fas fa-exclamation-triangle fa-fw text-warning mr-1"></i> Alerts</p>
                <div class="bg-box mb-3">
                    <ul class="nav flex-column mb-3">
                        {% if alerts.Events %}
                        <li class="nav-item">
                            <a class="nav-link" id="v-pills-events-tab" data-toggle="pill" href="#v-pills-events" role="tab" aria-controls="v-pills-events" aria-selected="true"><i class="fas fa-chevron-right fa-fw mr-1"></i> Events</a>
                        </li>
                        {% endif %}

                        {% if alerts.Goals %}
                        <li class="nav-item">
                            <a class="nav-link" id="v-pills-goals-tab" data-toggle="pill" href="#v-pills-goals" role="tab" aria-controls="v-pills-goals" aria-selected="true"><i class="fas fa-chevron-right fa-fw mr-1"></i> Goals</a>
                        </li>
                        {% endif %}

                        {% if alerts.Alerts %}
                        <li class="nav-item">
                            <a class="nav-link" id="v-pills-alerts-tab" data-toggle="pill" href="#v-pills-alerts" role="tab" aria-controls="v-pills-alerts" aria-selected="true"><i class="fas fa-chevron-right fa-fw mr-1"></i> Alerts</a>
                        </li>
                        {% endif %}

                        {% if alerts.Sorties %}
                        <li class="nav-item">
                            <a class="nav-link" id="v-pills-sorties-tab" data-toggle="pill" href="#v-pills-sorties" role="tab" aria-controls="v-pills-sorties" aria-selected="true"><i class="fas fa-chevron-right fa-fw mr-1"></i> Sorties</a>
                        </li>
                        {% endif %}

                        <li class="nav-item">
                            <a class="nav-link" id="v-pills-syndicatemissions-tab" data-toggle="pill" href="#v-pills-syndicatemissions" role="tab" aria-controls="v-pills-syndicatemissions" aria-selected="true"><i class="fas fa-chevron-right fa-fw mr-1"></i> Syndicate Missions</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="v-pills-activemissions-tab" data-toggle="pill" href="#v-pills-activemissions" role="tab" aria-controls="v-pills-activemissions" aria-selected="true"><i class="fas fa-chevron-right fa-fw mr-1"></i> Active Missions</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="v-pills-flashsales-tab" data-toggle="pill" href="#v-pills-flashsales" role="tab" aria-controls="v-pills-flashsales" aria-selected="true"><i class="fas fa-chevron-right fa-fw mr-1"></i> Flash Sales</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="v-pills-invasions-tab" data-toggle="pill" href="#v-pills-invasions" role="tab" aria-controls="v-pills-invasions" aria-selected="true"><i class="fas fa-chevron-right fa-fw mr-1"></i> Invasions</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="v-pills-nodeoverrides-tab" data-toggle="pill" href="#v-pills-nodeoverrides" role="tab" aria-controls="v-pills-nodeoverrides" aria-selected="true"><i class="fas fa-chevron-right fa-fw mr-1"></i> Node Overrides</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="v-pills-badlandnodes-tab" data-toggle="pill" href="#v-pills-badlandnodes" role="tab" aria-controls="v-pills-badlandnodes" aria-selected="true"><i class="fas fa-chevron-right fa-fw mr-1"></i> Badland Nodes</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="v-pills-voidtraders-tab" data-toggle="pill" href="#v-pills-voidtraders" role="tab" aria-controls="v-pills-voidtraders" aria-selected="true"><i class="fas fa-chevron-right fa-fw mr-1"></i> Void Traders</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-9 my-3">
            <div class="bg-black-t pt-3 px-3">
                <div class="tab-content" id="v-pills-tabContent">
                    <div class="tab-pane fade show active" id="v-pills-events" role="tabpanel" aria-labelledby="v-pills-events-tab">
                        <h2 class="h5"><i class="far fa-calendar-check fa-fw text-info mr-1"></i> Events</h2>
                        <p class="text-muted m-0">A fight that never ends between the Grineer, Corpus and Infested. Here you can see all the Invasions.</p>
                        <hr>
                        <div class="row">
                            {% for event in alerts.Events reversed %}                            
                                {% if event.Messages.0.LanguageCode == 'en' %}
                                <div class="col-md-6">
                                    <div id="{{event.id.oid}}" class="event bg-black-t mb-3">
                                        {% if event.ImageUrl %}
                                        <a href="{{event.Prop}}" target="_blank">
                                            <img class="img-fluid" src="{{event.ImageUrl}}">
                                        </a>
                                        {% endif %}
                                        <div class="media">                
                                            <div class="media-body p-3">
                                                <p class="mb-0"><i class="fas fa-chevron-right fa-fw text-info mr-1"></i> 
                                                    <a href="{{event.Prop}}" target="_blank">
                                                        {% for message in event.Messages %}
                                                            {% if forloop.first %}
                                                                {{message.Message}}
                                                            {% endif %}
                                                        {% endfor %}
                                                    </a>
                                                </p>
                                                <p><span id="clock" class="float-right text-secondary mt-1">{{event.Date.date.numberLong|unix_to_readeable|naturalday}}</span></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}                        
                        </div>
                    </div>
                    <div class="tab-pane fade" id="v-pills-goals" role="tabpanel" aria-labelledby="v-pills-goals-tab">
                        <h2 class="h5"><i class="fas fa-chevron-right fa-fw text-info mr-1"></i> Goals</h2>
                        <p class="text-muted m-0">A fight that never ends between the Grineer, Corpus and Infested. Here you can see all the Invasions.</p>
                        <hr>
                        {% for goal in alerts.Goals %}
                        <ul>
                            <li>id: {{goal.id.oid}}</li>
                            <li>Activation: {{goal.Activation.date.numberLong}}</li>
                            <li>Expiry: {{goal.Expiry.date.numberLong}}</li>
                            <li>Node: {{goal.Node}}</li>
                            <li>ScoreVar: {{goal.ScoreVar}}</li>
                            <li>ScoreLocTag: {{goal.ScoreLocTag}}</li>
                            <li>Count: {{goal.Count}}</li>
                            <li>HealthPct: {{goal.HealthPct}}</li>
                            <li>Regions:
                                    {% for region in goal.Regions %}
                                        {{region}}
                                    {% endfor %}</li>
                            <li>Desc: {{goal.Desc}}</li>
                            <li>Tooltip: {{goal.Tooltip}}</li>
                            <li>OptionalInMission: {{goal.OptionalInMission}}</li>
                            <li>Tag: {{goal.Tag}}</li>
                            <li>UpgradeIds:
                                    {% for upgradeid in goal.UpgradeIds %}
                                        {{upgradeid}}
                                    {% endfor %}</li>
                            <li>Personal: {{goal.Personal}}</li>
                            <li>Community: {{goal.Community}}</li>
                            <li>Goal: {{goal.Goal}}</li>
                            <li>Rewards: </li>
                            <li>credits: {{goal.Reward.credits}}</li>
                            <li>xp: {{goal.Reward.xp}}</li>
                            <li>    {% for reward in goal.Reward %}
                                        {% for item in reward.items %}
                                            {{item}}
                                        {% endfor %}
                                        {% for item in reward.countedItems %}
                                            {{item}}
                                        {% endfor %}
                                    {% endfor %}</li>
                            <li>InterimGoals:
                                <ul>
                                    {% for interimgoals in goal.InterimGoals %}
                                        <li>{{interimgoals}}</li>
                                    {% endfor %}
                                </ul>
                            </li>
                            <li>InterimRewards:
                                <ul>
                                    {% for interimreward in goal.InterimRewards %}
                                        <li>{{interimreward}}</li>
                                    {% endfor %}
                                </ul>
                            </li>
                            <li>InterimRewardMessages:
                                <ul>
                                    {% for interimrewardmessage in goal.InterimRewardMessages %}
                                        <li>sender: {{interimrewardmessage.sender}}</li>
                                        <li>subject: {{interimrewardmessage.subject}}</li>
                                        <li>message: {{interimrewardmessage.message}}</li>
                                        <ul>
                                            {% for attachment in interimrewardmessages.attachments %}

                                            {% endfor %}
                                        </ul>
                                    {% endfor %}
                                </ul>
                            </li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                        </ul>
                        {% endfor %}
                    </div>
                    <div class="tab-pane fade" id="v-pills-alerts" role="tabpanel" aria-labelledby="v-pills-alerts-tab">
                        <h2 class="h5"><i class="fas fa-chevron-right fa-fw text-info mr-1"></i> Alerts</h2>
                        <p class="text-muted m-0">A fight that never ends between the Grineer, Corpus and Infested. Here you can see all the Invasions.</p>
                        <hr>
                    </div>
                    {% if alerts.Sorties %}
                    <div class="tab-pane fade" id="v-pills-sorties" role="tabpanel" aria-labelledby="v-pills-sorties-tab">
                        <h2 class="h5"><i class="fas fa-chevron-right fa-fw text-info mr-1"></i> Sorties</h2>
                        <p class="text-muted m-0">They are the missions of 3 stages that are carried out every 24h. Here you can get several prizes. {% for sortie in alerts.Sorties %}<span class="float-right badge badge-info p-1" data-countdown="{{sortie.Expiry.date.numberLong|human_time}}"></span>{% endfor %}</p>
                        <hr>
                        {% for sortie in alerts.Sorties %}
                            {% for sortie in sortie.Variants %}
                            <div class="media bg-black-t p-3 border-top border-bottom border-dark">
                                <img src="https://via.placeholder.com/57x57" class="mr-3" alt="...">
                                <div class="media-body">
                                    <p id="{{sortie.node}}" class="m-0">
                                        <span class="text-info font-weight-bold">{{sortie.node|solnode_name}} </span>
                                        Level: 
                                        {% if forloop.first %}
                                        50 - 60
                                        {% elif forloop.last %}
                                        80 - 100
                                        {% else %}
                                        65 - 80
                                        {% endif %}
                                    </p>
                                    <p id="{{sortie.missionType}}" class="font-weight-bold m-0">Mission: {{sortie.missionType|mission_name}}</p>
                                    <p id="{{sortie.modifierType}}" class="font-weight-bold m-0">Conditions: {{sortie.modifierType|sortie_condition}}</p>
                                </div>
                            </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="tab-pane fade" id="v-pills-syndicatemissions" role="tabpanel" aria-labelledby="v-pills-syndicatemissions-tab">
                        <h2 class="h5"><i class="fas fa-chevron-right fa-fw text-info mr-1"></i> Syndicate Missions</h2>
                        <p class="text-muted m-0">A fight that never ends between the Grineer, Corpus and Infested. Here you can see all the Invasions.</p>
                        <hr>
                    </div>
                    <div class="tab-pane fade" id="v-pills-activemissions" role="tabpanel" aria-labelledby="v-pills-activemissions-tab">
                        <h2 class="h5"><i class="fas fa-chevron-right fa-fw text-info mr-1"></i> Active Missions</h2>
                        <p class="text-muted m-0">A fight that never ends between the Grineer, Corpus and Infested. Here you can see all the Invasions.</p>
                        <hr>
                    </div>
                    <div class="tab-pane fade" id="v-pills-flashsales" role="tabpanel" aria-labelledby="v-pills-flashsales-tab">
                        <h2 class="h5"><i class="fas fa-chevron-right fa-fw text-info mr-1"></i> Flash Sales</h2>
                        <p class="text-muted m-0">A fight that never ends between the Grineer, Corpus and Infested. Here you can see all the Invasions.</p>
                        <hr>
                    </div>
                    <div class="tab-pane fade" id="v-pills-invasions" role="tabpanel" aria-labelledby="v-pills-invasions-tab">
                        <h2 class="h5"><i class="fas fa-chevron-right fa-fw text-info mr-1"></i> Invasions</h2>
                        <p class="text-muted m-0">A fight that never ends between the Grineer, Corpus and Infested. Here you can see all the Invasions.</p>
                        <hr>
                    </div>
                    <div class="tab-pane fade" id="v-pills-nodeoverrides" role="tabpanel" aria-labelledby="v-pills-nodeoverrides-tab">
                        <h2 class="h5"><i class="fas fa-chevron-right fa-fw text-info mr-1"></i> Node Overrides</h2>
                        <p class="text-muted m-0">A fight that never ends between the Grineer, Corpus and Infested. Here you can see all the Invasions.</p>
                        <hr>
                    </div>
                    <div class="tab-pane fade" id="v-pills-badlandnodes" role="tabpanel" aria-labelledby="v-pills-badlandnodes-tab">
                        <h2 class="h5"><i class="fas fa-chevron-right fa-fw text-info mr-1"></i> Badland Nodes</h2>
                        <p class="text-muted m-0">A fight that never ends between the Grineer, Corpus and Infested. Here you can see all the Invasions.</p>
                        <hr>
                    </div>
                    <div class="tab-pane fade" id="v-pills-voidtraders" role="tabpanel" aria-labelledby="v-pills-voidtraders-tab">
                        <h2 class="h5"><i class="fas fa-chevron-right fa-fw text-info mr-1"></i> Void Traders</h2>
                        <p class="text-muted m-0">When do you want to know when the trader comes, you questions in the chat 'when baro'. Here you do not have to do it!</p>
                        <hr>
                        {% for trader in alerts.VoidTraders %}
                            <div id="void-traders" class="void bg-black-t border-top border-bottom border-dark">
                                <div class="media p-3">
                                    <img src="https://via.placeholder.com/57x57" class="mr-3" alt="...">
                                    <div class="media-body">
                                        <p class="m-0 font-weight-bold text-info">{{trader.Character}}</p>
                                        <p id="{{trader.Node}}" class="m-0">{{trader.Node|hubs_name}}</p>
                                        <p class="m-0"><span class="font-weight-bold">Arrives:</span> [<span data-countdown="{{trader.Activation.date.numberLong|human_time}}"></span>] - <span class="font-weight-bold">Left:</span> [<span data-countdown="{{trader.Expiry.date.numberLong|human_time}}"></span>]</p>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block footer_extra %}
<script>
    $('[data-countdown]').each(function() {
        var $this = $(this), finalDate = $(this).data('countdown');
        $this.countdown(finalDate, function(event) {
            $this.html(event.strftime('%D Days - %H:%M:%S'));
        });
    });
</script>
{% endblock %}